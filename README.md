# Email Microservice

## Описание проекта

Данный микросервис реализует базовую функциональность работы с электронной почтой:

- Отправка писем через SMTP-сервер.
- Получение списка входящих и исходящих писем с возможностью фильтрации.
- Получение статистики по количеству отправленных и полученных писем за указанный период.

В проекте реализованы REST API на FastAPI с использованием Pydantic-схем и PostgreSQL в качестве базы данных. Для тестирования используется Mailpit — локальный SMTP/IMAP сервер в Docker.

---

## Основной функционал

### Отправка письма

- **POST** `/emails/send`

Принимает параметры:

- `to` — список email получателей,
- `subject` — тема письма,
- `body` — тело письма (HTML или текст).

Отправляет письмо через SMTP и сохраняет информацию в базе.

---

### Получение списка писем

- **GET** `/emails`

Поддерживает фильтрацию по параметрам:

- Дата (период `from`, `to`),
- Отправитель,
- Получатель,
- Поиск по теме (подстрока).

Возвращает список входящих и исходящих писем.

---

### Получение статистики

- **GET** `/emails/stats`

Возвращает количество отправленных и полученных писем за заданный период (`from`, `to`).

---

## Расширения функционала

Для расширения возможностей сервиса реализована базовая регистрация и аутентификация пользователей.

- Добавлена модель пользователя.
- Реализована простая регистрация `/auth/register`.
- Вход пользователя `/auth/login` с выдачей JWT токена.
- Доступ к API `/emails` — только для аутентифицированных пользователей.

---

## Использование сервиса

1. **Регистрация пользователя**

   Отправьте POST-запрос на `/auth/register` с данными:

   ```json
   {
     "email": "user@example.com",
     "password": "strongpassword"
   }
2. **Вход пользователя**

    POST `/auth/login` с теми же данными для получения токена доступа.

3. **Работа с API писем**
    Во всех запросах к /emails/* используйте в заголовке Authorization: Bearer <токен>.

4. **Примеры**

- Отправить письмо: POST /emails/send
- Получить список писем: GET /emails
- Получить статистику: GET /emails/stats

## Локальный запуск и инфраструктура
В проекте используется docker-compose для запуска приложения и всей инфраструктуры.

- Приложение доступно по адресу: http://localhost:8000
- Mailpit (SMTP/IMAP сервер) доступен по адресу: http://localhost:8025

##  Запуск

## Клонирование репозитория
git clone <URL_репозитория>
cd <название_папки_проекта>

##  Dcoker
docker-compose up --build

## Выполнение миграций базы данных
docker-compose exec app alembic -c application/alembic.ini upgrade head

## Документация API
Автоматически генерируется FastAPI и доступна по адресу:
http://localhost:8000/docs

## Дополнительно
- Все конфигурационные параметры настраиваются через переменные окружения.
- Логирование настроено в структурированном формате с уровнями INFO и ERROR.
- Для тестирования используется pytest (команда pytest в терминале).
